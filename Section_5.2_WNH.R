rm(list=ls())
library(rstan)
seet<-123
set.seed(seet)
App<-2
est1<-matrix(c(5.6708,2.6781,0.0793,0.9853, 2.4485, 0.2825, 0.0083, 0.4853),2,4,byrow = T)
est2<-matrix(c(0.2135,1.0479,0.6657,1.3431, 0.0881, 0.2106, 0.1176, 0.4799),2,4,byrow = T)

#Data
 x1 <-  c(194, 15, 41, 29, 33, 181, 413, 14, 58, 37, 100, 65, 9, 169, 447, 184, 36, 201, 118, 34, 31, 18,
              18, 67, 57, 62, 7, 22, 34, 90, 10, 60, 186, 61, 49, 14, 24, 56, 20, 79, 84, 44, 59, 29, 118, 25,
              156, 310, 76, 26, 44, 23, 62, 130, 208, 70, 101, 208, 74, 57, 48, 29, 502, 12, 70, 21, 29, 386,
              59, 27, 153, 26, 326, 55, 320, 56, 104, 220, 239, 47, 246, 176, 182, 33, 15, 104, 35, 23, 261,
              87, 7, 120, 14, 62, 47, 225, 71, 246, 21, 42, 20, 5, 12, 120, 11, 3, 14, 71, 11, 14, 11, 16, 90,
              1, 16, 52, 95, 97, 51, 11, 4, 141, 18, 142, 68, 77, 80, 1, 16, 106, 206, 82, 54, 31, 216, 46,
              111, 39, 63, 18, 191, 18, 163, 24, 50, 44, 102, 72, 22, 39, 3, 15, 197, 188, 79, 88, 46, 5, 5,
              36, 22, 139, 210, 97, 30, 23, 13, 14, 359, 9, 12, 270, 603, 3, 104, 2, 438, 50, 254, 5, 283, 35, 12,
              130, 493, 487, 18, 100, 7, 98, 5, 85, 91, 43, 230, 3, 130, 102, 209, 14, 57, 54, 32, 67, 59, 134, 152,
              27, 14, 230, 66, 61, 34)
 x2 <-  c(0.046, 1.436, 2.592, 0.140, 1.492, 2.600, 0.150, 1.580, 2.670, 0.248, 1.719, 2.717,
                  0.280, 1.794, 2.819, 0.313, 1.915, 2.820, 0.389, 1.920, 2.878, 0.487, 1.963, 2.950,
                  0.622, 1.978, 3.003, 0.900, 2.053, 3.102, 0.952, 2.065, 3.304, 0.996, 2.117, 3.483,
                  1.003, 2.137, 3.500, 1.010, 2.141, 3.622, 1.085, 2.163, 3.665, 1.092, 2.183, 3.695,
                  1.152, 2.240, 4.015, 1.183, 2.341, 4.628, 1.244, 2.435, 4.806, 1.249, 2.464, 4.881,
                  1.262, 2.543, 5.140)
if(App==1){
  x=x1
  meanes=est1[1,]
  sdes=est1[2,]
} else if(App==2) {
  x=x2
  meanes=est2[1,]
  sdes=est2[2,]
} else {
  print("The value in App is not valid.")
}
 #Model
model_code <- '
data {
  int n;
  real x[n];
  vector[4] meanes;
  vector[4] sdes;
}

parameters {
  real<lower=0> alpha;
  real<lower=0> lambda;
  real<lower=0> a;
  real<lower=0> b;
}

model {
  a ~ normal(meanes[1], sdes[1]); 
  b ~ normal(meanes[2], sdes[2]); 
  alpha ~ normal(meanes[3], sdes[3]); 
  lambda ~ normal(meanes[4], sdes[4]); 
  for(i in 1:n){
    target += log(a*b*alpha*lambda*(1+lambda*x[i])^(alpha-1)*
                  (1-exp(1-(1+lambda*x[i])^alpha))^(b-1)*
                  exp(-b*(1-(1+lambda*x[i])^alpha)-a*
                      (exp((1+lambda*x[i])^alpha-1)-1)^b));
  }
}'

#Data for Stan
data_list <- list(n = length(x),
                  x = x)

#Fit Model Stan
fit <- stan(model_code = model_code, data = data_list,
            chains = 4, iter = 10000, warmup = 2000,
            control = list(adapt_delta = 0.95))

#Result
summary(fit, pars = c("a", "b","alpha", "lambda" ))


